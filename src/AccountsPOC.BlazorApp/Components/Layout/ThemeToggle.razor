@inject IJSRuntime JS

<button class="theme-toggle" @onclick="ToggleTheme" title="@GetTooltip()">
    @if (isDarkMode)
    {
        <i class="bi bi-sun-fill"></i>
    }
    else
    {
        <i class="bi bi-moon-fill"></i>
    }
</button>

@code {
    private bool isDarkMode = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            try
            {
                // Get theme from localStorage or check system preference
                var theme = await JS.InvokeAsync<string>("localStorage.getItem", "theme");
                
                if (string.IsNullOrEmpty(theme))
                {
                    // Check system preference
                    var prefersDark = await JS.InvokeAsync<bool>("eval", 
                        "window.matchMedia('(prefers-color-scheme: dark)').matches");
                    theme = prefersDark ? "dark" : "light";
                }
                
                isDarkMode = theme == "dark";
                StateHasChanged();
            }
            catch
            {
                // Default to light mode if there's any error
                isDarkMode = false;
            }
        }
    }

    private async Task ToggleTheme()
    {
        isDarkMode = !isDarkMode;
        var theme = isDarkMode ? "dark" : "light";
        
        try
        {
            await JS.InvokeVoidAsync("localStorage.setItem", "theme", theme);
            await JS.InvokeVoidAsync("eval", $"document.documentElement.setAttribute('data-theme', '{theme}')");
        }
        catch
        {
            // Silently handle errors
        }
    }

    private string GetTooltip()
    {
        return isDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode";
    }
}
