@* Pagination Component with Sage 200 style features *@

<div class="pagination-wrapper">
    @if (ShowInfo && TotalCount > 0)
    {
        <div class="pagination-info">
            Showing @StartItem to @EndItem of @TotalCount entries
        </div>
    }
    
    <div class="pagination-controls">
        @if (ShowPageSizeDropdown && PageSizes.Any())
        {
            <div class="page-size-selector">
                <label>Show</label>
                <select class="form-select form-select-sm" @onchange="OnPageSizeChanged">
                    @foreach (var size in PageSizes)
                    {
                        <option value="@size" selected="@(size == PageSize)">@size</option>
                    }
                </select>
                <label>entries</label>
            </div>
        }
        
        <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm mb-0">
                <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                    <button class="page-link" @onclick="() => GoToPage(1)" disabled="@(CurrentPage == 1)">
                        <i class="bi bi-chevron-bar-left"></i>
                    </button>
                </li>
                <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                    <button class="page-link" @onclick="() => GoToPage(CurrentPage - 1)" disabled="@(CurrentPage == 1)">
                        <i class="bi bi-chevron-left"></i> Previous
                    </button>
                </li>
                
                @if (ShowPageNumbers)
                {
                    @foreach (var page in GetPageNumbers())
                    {
                        @if (page == -1)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                        else
                        {
                            <li class="page-item @(page == CurrentPage ? "active" : "")">
                                <button class="page-link" @onclick="() => GoToPage(page)">@page</button>
                            </li>
                        }
                    }
                }
                
                <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                    <button class="page-link" @onclick="() => GoToPage(CurrentPage + 1)" disabled="@(CurrentPage == TotalPages)">
                        Next <i class="bi bi-chevron-right"></i>
                    </button>
                </li>
                <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                    <button class="page-link" @onclick="() => GoToPage(TotalPages)" disabled="@(CurrentPage == TotalPages)">
                        <i class="bi bi-chevron-bar-right"></i>
                    </button>
                </li>
            </ul>
        </nav>
    </div>
</div>

<style>
    .pagination-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 8px;
    }

    .pagination-info {
        color: #6c757d;
        font-size: 0.875rem;
    }

    .pagination-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .page-size-selector {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
    }

    .page-size-selector label {
        margin: 0;
        color: #6c757d;
    }

    .page-size-selector select {
        width: 70px;
    }

    .pagination {
        margin: 0;
    }

    .page-link {
        border-color: #dee2e6;
        color: #667eea;
    }

    .page-link:hover {
        background-color: #e9ecef;
        border-color: #dee2e6;
        color: #5568d3;
    }

    .page-item.active .page-link {
        background-color: #667eea;
        border-color: #667eea;
    }

    .page-item.disabled .page-link {
        color: #6c757d;
        cursor: not-allowed;
    }

    @@media (max-width: 768px) {
        .pagination-wrapper {
            flex-direction: column;
            align-items: stretch;
        }

        .pagination-controls {
            flex-direction: column;
            align-items: stretch;
        }

        .page-size-selector {
            justify-content: center;
        }

        nav {
            width: 100%;
        }

        .pagination {
            justify-content: center;
        }
    }
</style>

@code {
    [Parameter] public int CurrentPage { get; set; } = 1;
    [Parameter] public int PageSize { get; set; } = 25;
    [Parameter] public int TotalCount { get; set; }
    [Parameter] public List<int> PageSizes { get; set; } = new() { 10, 25, 50, 100 };
    [Parameter] public bool ShowInfo { get; set; } = true;
    [Parameter] public bool ShowPageNumbers { get; set; } = true;
    [Parameter] public bool ShowPageSizeDropdown { get; set; } = true;
    [Parameter] public int MaxPageNumbers { get; set; } = 5;
    [Parameter] public EventCallback<int> OnPageChanged { get; set; }
    [Parameter] public EventCallback<int> OnPageSizeChanged { get; set; }

    private int TotalPages => (int)Math.Ceiling((double)TotalCount / PageSize);
    private int StartItem => TotalCount == 0 ? 0 : (CurrentPage - 1) * PageSize + 1;
    private int EndItem => Math.Min(CurrentPage * PageSize, TotalCount);

    private async Task GoToPage(int page)
    {
        if (page < 1 || page > TotalPages || page == CurrentPage)
            return;

        await OnPageChanged.InvokeAsync(page);
    }

    private async Task OnPageSizeChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int newSize))
        {
            await OnPageSizeChanged.InvokeAsync(newSize);
        }
    }

    private List<int> GetPageNumbers()
    {
        var pages = new List<int>();
        
        if (TotalPages <= MaxPageNumbers)
        {
            // Show all pages if total is less than max
            for (int i = 1; i <= TotalPages; i++)
            {
                pages.Add(i);
            }
        }
        else
        {
            // Always show first page
            pages.Add(1);
            
            // Calculate range around current page
            int start = Math.Max(2, CurrentPage - 1);
            int end = Math.Min(TotalPages - 1, CurrentPage + 1);
            
            // Add ellipsis if needed before current range
            if (start > 2)
            {
                pages.Add(-1); // -1 represents ellipsis
            }
            
            // Add pages around current
            for (int i = start; i <= end; i++)
            {
                pages.Add(i);
            }
            
            // Add ellipsis if needed after current range
            if (end < TotalPages - 1)
            {
                pages.Add(-1); // -1 represents ellipsis
            }
            
            // Always show last page
            pages.Add(TotalPages);
        }
        
        return pages;
    }
}
